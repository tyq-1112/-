## 功能

**基于TCP/IP的多用户网络聊天**

1.显示在线用户列表

2.私发消息

3.群发消息

4.发送文件

5.离线留言和发文件

6.服务器推送消息

## 技术

项目框架设计

java面向对象编程

网路编程

多线程

IO流

Mysql(集合充当内存数据库)



## 流程

1.首先在common包中定义 客户端与 服务端的公共的对象 User 和 Message 

2.User 和 Message 对象序列化，因为需要通过Object对象流来读写对象

3.编写登录及登录成功后的界面，然后具体编写用户选择的指令

4.客户端发送登录(User)请求

>客户端发送一个User对象给服务器，等待服务器回复的Message对象

> 如果成功，需要启动一个线程（放进管理线程的集合中），维护这个socket，保持与服务器端一直通信

> 客户端socket一直等待服务端发送的Message，然后做相应的业务处理

5.服务器处理登录请求,回复Message

>服务器在9999端口监听，接收到客户端发送的User对象，在DB中验证
>
>返回一个Message对象，表示是否用户登录合法的消息
>
>如果用户合法，需要启动一个线程(放进管理线程的集合中)，维护socket
>
>服务器socket一直等待客户端发送的Message，然后做相应的业务处理

6.客户端退出系统：

> 客户端发送Message对象给服务端，exit(0)
>
> 服务端从管理线程的集合中删除对应的线程，把持有的socket关闭退出

7.客户端获取在线用户

>从管理线程集中，得到客户端对应的socket，发送一个Message给服务端
>
>服务端返回一个Message(包含在线用户列表)给相应的客户端

8.私聊：

> 客户端构建Message对象通过对应的socket发给服务器
>
> 服务器从管理线程的集合中，根据Message对象的getter获取对应的socket
>
> 服务器将Message对象转发给指定的客户端
>
> getter对应的客户端读取Message对象，显示内容

9.群发：

>客户端构建Message对象通过对应的socket发给服务器
>
>服务器遍历集合，得到所有的线程的socket(排除群发消息这个用户)，然后把Message转发
>
>客户端显示内容

10.发送文件

> 把文件读取到客户端，(字节数组)封装到Message对象，发送给服务端
>
> 服务端把Message对象转发到getter对应的线程socket，
>
> 客户端接收文件，将文件保存到磁盘

11.离线发送消息

> 服务端用一个集合ConcurrentHashMap存放离线的Message : <userId , ArrayList<Message>>
>
> 客户端登录成功，服务端遍历集合，看是否存在对应客户端的Message
>
> 服务端发送Message到客户端，删除集合中客户端对应的key-value

12.服务器推送消息

> 服务器单独启用一个线程用来推送消息
>
> 遍历集合，得到所有的socket，发送Message对象